{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ACE Delta Schema",
  "description": "Schema for ACE playbook delta entries. Deltas represent learned patterns with confidence scoring.",
  "type": "object",
  "required": ["delta_id", "problem", "solution", "condition", "confidence"],
  "properties": {
    "delta_id": {
      "type": "string",
      "pattern": "^ace_\\d+_[a-z0-9]+$",
      "description": "Unique identifier for the delta (format: ace_{timestamp}_{random})"
    },
    "problem": {
      "type": "string",
      "minLength": 10,
      "maxLength": 200,
      "description": "The problem this delta addresses"
    },
    "solution": {
      "type": "string",
      "minLength": 10,
      "maxLength": 500,
      "description": "The recommended solution"
    },
    "condition": {
      "type": "string",
      "minLength": 5,
      "maxLength": 100,
      "description": "When this delta applies (e.g., 'When using /cook skill')"
    },
    "helpful_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Automated positive signals (successful executions)"
    },
    "not_helpful_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Automated negative signals (failed executions)"
    },
    "human_feedback_count": {
      "type": "integer",
      "minimum": 0,
      "description": "Human positive signals (weighted 3x per ACE config)"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Confidence score (must be >= 0.80 to promote to active playbook)"
    },
    "created": {
      "type": "string",
      "format": "date-time",
      "description": "When this delta was first created"
    },
    "last_helpful": {
      "type": "string",
      "format": "date-time",
      "description": "Last time this delta was marked helpful"
    },
    "source_events": {
      "type": "array",
      "items": { "type": "string" },
      "maxItems": 10,
      "description": "Event IDs that contributed to this delta (max 10 for tracing)"
    }
  },
  "additionalProperties": false
}
