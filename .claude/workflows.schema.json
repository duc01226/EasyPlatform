{
    "$id": "workflows.schema.json",
    "$schema": "http://json-schema.org/draft-07/schema#",
    "additionalProperties": false,
    "definitions": {
        "CommandMappingEntry": {
            "additionalProperties": false,
            "description": "Maps a logical command key to platform-specific command invocations for Claude Code and GitHub Copilot.",
            "properties": {
                "claude": {
                    "description": "Claude Code slash command (must start with /).",
                    "examples": ["/plan", "/cook", "/fix", "/code-review"],
                    "minLength": 2,
                    "pattern": "^/",
                    "title": "Claude Code Command",
                    "type": "string"
                },
                "copilot": {
                    "description": "GitHub Copilot slash command (must start with /).",
                    "examples": ["/plan", "/cook", "/fix"],
                    "minLength": 2,
                    "pattern": "^/",
                    "title": "Copilot Command",
                    "type": "string"
                }
            },
            "required": ["claude", "copilot"],
            "title": "Command Mapping Entry",
            "type": "object"
        },
        "PreActions": {
            "additionalProperties": false,
            "description": "Actions to perform before starting the workflow sequence. Used to load skills, inject context, or pre-read files.",
            "properties": {
                "activateSkill": {
                    "description": "Name of the skill to activate before workflow execution (e.g., 'product-owner', 'test-spec').",
                    "examples": ["product-owner", "test-spec", "project-manager", "ui-ux-pro-max", "planning"],
                    "minLength": 1,
                    "title": "Activate Skill",
                    "type": "string"
                },
                "injectContext": {
                    "description": "Context text to inject into the agent's prompt before workflow execution. Typically contains workflow-specific instructions or checklists.",
                    "minLength": 1,
                    "title": "Inject Context",
                    "type": "string"
                },
                "readFiles": {
                    "description": "List of file paths (relative to project root) to read before workflow execution. Used to pre-load templates, guides, or reference documents.",
                    "items": {
                        "minLength": 1,
                        "type": "string"
                    },
                    "minItems": 1,
                    "title": "Read Files",
                    "type": "array"
                }
            },
            "title": "Pre-Actions",
            "type": "object"
        },
        "Settings": {
            "additionalProperties": false,
            "description": "Global configuration for workflow detection and overrides.",
            "properties": {
                "allowOverride": {
                    "default": true,
                    "description": "Whether users can bypass workflow detection using the override prefix.",
                    "title": "Allow Override",
                    "type": "boolean"
                },
                "confirmHighImpact": {
                    "default": true,
                    "description": "Whether to prompt for user confirmation before executing workflows marked with confirmFirst: true.",
                    "title": "Confirm High Impact",
                    "type": "boolean"
                },
                "enabled": {
                    "default": true,
                    "description": "Master toggle to enable or disable all workflow detection and automation.",
                    "title": "Enable Workflows",
                    "type": "boolean"
                },
                "overridePrefix": {
                    "description": "Prefix string that users type to bypass automatic workflow detection (e.g., 'quick:').",
                    "examples": ["quick:"],
                    "minLength": 1,
                    "title": "Override Prefix",
                    "type": "string"
                },
                "showDetection": {
                    "default": true,
                    "description": "Whether to display the detected intent and workflow sequence to the user before execution.",
                    "title": "Show Detection",
                    "type": "boolean"
                }
            },
            "required": ["enabled", "allowOverride", "overridePrefix", "confirmHighImpact", "showDetection"],
            "title": "Global Settings",
            "type": "object"
        },
        "WorkflowEntry": {
            "additionalProperties": false,
            "description": "Defines a workflow selected by AI-native intent detection. Contains natural language descriptions for when to use/not use, an ordered sequence of commands, and optional pre-actions.",
            "properties": {
                "confirmFirst": {
                    "description": "Whether to ask for user confirmation before starting this workflow. Recommended for high-impact workflows (feature, refactor, release).",
                    "title": "Confirm Before Execution",
                    "type": "boolean"
                },
                "description": {
                    "description": "Detailed description of what this workflow does and when it is triggered.",
                    "minLength": 1,
                    "title": "Workflow Description",
                    "type": "string"
                },
                "name": {
                    "description": "Human-readable display name for the workflow, shown to users during detection.",
                    "examples": ["Feature Implementation", "Bug Fix", "Code Investigation"],
                    "minLength": 1,
                    "title": "Workflow Name",
                    "type": "string"
                },
                "preActions": {
                    "$ref": "#/definitions/PreActions"
                },
                "sequence": {
                    "description": "Ordered list of command keys (referencing commandMapping) to execute. Commands run in sequence from first to last.",
                    "items": {
                        "minLength": 1,
                        "type": "string"
                    },
                    "minItems": 1,
                    "title": "Command Sequence",
                    "type": "array"
                },
                "whenNotToUse": {
                    "description": "Natural language description of when NOT to select this workflow. Used for disambiguation when multiple workflows could match.",
                    "minLength": 1,
                    "title": "When Not To Use",
                    "type": "string"
                },
                "whenToUse": {
                    "description": "Natural language description of when the AI should select this workflow. The AI model reads this to decide which workflow matches the user's intent.",
                    "examples": [
                        "User reports a bug, error, crash, broken functionality, or asks to fix/debug/troubleshoot an issue.",
                        "User wants to implement, add, create, or build a new feature or functionality."
                    ],
                    "minLength": 1,
                    "title": "When To Use",
                    "type": "string"
                }
            },
            "required": ["name", "description", "confirmFirst", "sequence", "whenToUse"],
            "title": "Workflow Definition",
            "type": "object"
        }
    },
    "description": "Schema for Claude Code and GitHub Copilot workflow automation configuration. Defines AI-native intent detection, command mapping, and workflow sequences for AI agent orchestration.",
    "properties": {
        "$schema": {
            "description": "Path or URL to the JSON Schema file for IDE validation and autocompletion.",
            "title": "Schema Reference",
            "type": "string"
        },
        "commandMapping": {
            "additionalProperties": {
                "$ref": "#/definitions/CommandMappingEntry"
            },
            "description": "Maps logical command keys to platform-specific command strings for Claude Code and GitHub Copilot. Each key is referenced by workflow sequences.",
            "minProperties": 1,
            "title": "Command Mapping",
            "type": "object"
        },
        "description": {
            "description": "Human-readable description of this workflow configuration file.",
            "minLength": 1,
            "title": "Configuration Description",
            "type": "string"
        },
        "settings": {
            "$ref": "#/definitions/Settings"
        },
        "version": {
            "description": "Semantic version of the workflow configuration (e.g., 2.0.0).",
            "examples": ["1.0.0", "2.0.0"],
            "pattern": "^\\d+\\.\\d+\\.\\d+$",
            "title": "Configuration Version",
            "type": "string"
        },
        "workflows": {
            "additionalProperties": {
                "$ref": "#/definitions/WorkflowEntry"
            },
            "description": "Named workflow definitions selected by AI-native intent detection. Each workflow has natural language whenToUse/whenNotToUse descriptions that the AI reads to determine which workflow matches the user's intent.",
            "minProperties": 1,
            "title": "Workflow Definitions",
            "type": "object"
        }
    },
    "required": ["version", "description", "settings", "commandMapping", "workflows"],
    "title": "Workflow Configuration",
    "type": "object"
}
